name: NBA50 DoorDash Monitor

on:
  schedule:
    # UTCæ—¶é—´å‡Œæ™¨1ç‚¹ã€4ç‚¹ã€7ç‚¹è¿è¡ŒNBAç›‘æ§
    # å¯¹åº”ç¾è¥¿æ—¶é—´(PST UTC-8): 5PM, 8PM, 11PM å‰ä¸€å¤©
    # å¯¹åº”ç¾è¥¿æ—¶é—´(PDT UTC-7): 6PM, 9PM, 12AM å‰ä¸€å¤©
    - cron: '0 1,4,7 * * *'
  workflow_dispatch: # å…è®¸ä½ æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æµ‹è¯•
    inputs:
      test_mode:
        description: 'é€‰æ‹©è¿è¡Œæ¨¡å¼'
        required: false
        default: 'full'
        type: choice
        options:
        - full
        - webhook_test

jobs:
  check_nba:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cache pip dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests nba_api pandas pytz

      - name: Run NBA 50+ Points Monitor
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          echo "ğŸ• å½“å‰æ—¶é—´: $(date)"
          echo "ğŸ€ å¼€å§‹æ£€æŸ¥NBAçƒå‘˜50+å¾—åˆ†æƒ…å†µ..."
          
          # æ£€æŸ¥è¿è¡Œæ¨¡å¼
          if [ "${{ github.event_name }}" = "schedule" ]; then
            echo "ğŸ“… è‡ªåŠ¨è°ƒåº¦è¿è¡Œ - NBA 50+ç›‘æ§"
            python nba.py
          elif [ "${{ github.event.inputs.test_mode }}" = "webhook_test" ]; then
            echo "ğŸ§ª Webhookæµ‹è¯•æ¨¡å¼"
            python nba.py test
          else
            echo "ğŸ”§ æ‰‹åŠ¨å®Œæ•´æ¨¡å¼"
            python nba.py
          fi
          
          echo "âœ… NBAç›‘æ§å®Œæˆ"
