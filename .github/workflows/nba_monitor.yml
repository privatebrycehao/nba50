name: NBA50 DoorDash Monitor

on:
  schedule:
    # NBAæ¯”èµ›é€šå¸¸åœ¨ç¾ä¸œæ—¶é—´æ™šä¸Š7-10ç‚¹å¼€å§‹ï¼Œæ¯”èµ›æŒç»­2-3å°æ—¶
    # åœ¨æ¯”èµ›ç»“æŸåçš„æ—¶é—´æ®µè¿è¡Œæ£€æŸ¥ï¼ˆç¾ä¸œæ—¶é—´11PM, 1AM, 3AMï¼‰
    # å¯¹åº”UTCæ—¶é—´ 4AM, 6AM, 8AM
    - cron: '0 4,6,8 * * *'
  workflow_dispatch: # å…è®¸ä½ æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æµ‹è¯•
    inputs:
      test_mode:
        description: 'é€‰æ‹©è¿è¡Œæ¨¡å¼'
        required: false
        default: 'full'
        type: choice
        options:
        - full
        - webhook_test

jobs:
  check_nba:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cache pip dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests nba_api pandas

      - name: Test Webhook Connection (if webhook_test mode)
        if: ${{ github.event.inputs.test_mode == 'webhook_test' }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          echo "ğŸ§ª æµ‹è¯•Webhookè¿æ¥..."
          python nba.py test
          echo "Webhookæµ‹è¯•å®Œæˆ"

      - name: Run NBA 50+ Points Monitor (if full mode)
        if: ${{ github.event.inputs.test_mode != 'webhook_test' }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          echo "å¼€å§‹æ£€æŸ¥NBAçƒå‘˜50+å¾—åˆ†æƒ…å†µ..."
          python nba.py
          echo "æ£€æŸ¥å®Œæˆ"
