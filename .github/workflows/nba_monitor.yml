name: NBA50 DoorDash Monitor

on:
  schedule:
    # ç¾è¥¿æ—¶é—´ä¸‹åˆ4ç‚¹åˆ°æ™šä¸Š11ç‚¹ï¼Œæ¯3å°æ—¶è¿è¡Œä¸€æ¬¡
    # ç¾è¥¿æ—¶é—´: 4PM, 7PM, 10PM (PST UTC-8)
    # å¯¹åº”UTCæ—¶é—´: 12AM(00), 3AM(03), 6AM(06) æ¬¡æ—¥
    # æ³¨æ„ï¼šå¤ä»¤æ—¶æœŸé—´(PDT UTC-7)ä¼šæå‰1å°æ—¶
    - cron: '0 0,3,6 * * *'
  workflow_dispatch: # å…è®¸ä½ æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®æµ‹è¯•
    inputs:
      test_mode:
        description: 'é€‰æ‹©è¿è¡Œæ¨¡å¼'
        required: false
        default: 'full'
        type: choice
        options:
        - full
        - webhook_test

jobs:
  check_nba:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cache pip dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests nba_api pandas

      - name: Test Webhook Connection (if webhook_test mode)
        if: ${{ github.event.inputs.test_mode == 'webhook_test' }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          echo "ğŸ§ª æµ‹è¯•Webhookè¿æ¥..."
          python nba.py test
          echo "Webhookæµ‹è¯•å®Œæˆ"

      - name: Run NBA 50+ Points Monitor (if full mode)
        if: ${{ github.event.inputs.test_mode != 'webhook_test' }}
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
        run: |
          echo "å¼€å§‹æ£€æŸ¥NBAçƒå‘˜50+å¾—åˆ†æƒ…å†µ..."
          python nba.py
          echo "æ£€æŸ¥å®Œæˆ"
