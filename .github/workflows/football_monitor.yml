name: European Football Daily Summary

on:
  schedule:
    # ç¾è¥¿æ—¶é—´ä¸‹åˆ3ç‚¹è¿è¡Œ
    # ç¾è¥¿æ—¶é—´: 3PM (PST UTC-8 / PDT UTC-7)
    # å¯¹åº”UTCæ—¶é—´: 11PM(23) å½“æ—¥ (å†¬å­£) / 10PM(22) å½“æ—¥ (å¤å­£)
    # ä½¿ç”¨å†¬å­£æ—¶é—´UTC 23:00ï¼Œæ¯å¤©è¿è¡Œ
    - cron: '0 23 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è¿è¡Œ
    inputs:
      test_mode:
        description: 'é€‰æ‹©è¿è¡Œæ¨¡å¼'
        required: false
        default: 'full'
        type: choice
        options:
        - full
        - test

jobs:
  football_summary:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'

      - name: Cache pip dependencies
        uses: actions/cache@v3
        with:
          path: ~/.cache/pip
          key: ${{ runner.os }}-pip-football-${{ hashFiles('**/requirements.txt') }}
          restore-keys: |
            ${{ runner.os }}-pip-football-
            ${{ runner.os }}-pip-

      - name: Install dependencies
        run: |
          pip install --upgrade pip
          pip install requests pytz google-genai

      - name: Run Football Monitor
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK }}
          GEMINI_KEY: ${{ secrets.GEMINI_KEY }}
        run: |
          echo "ğŸ• å½“å‰æ—¶é—´: $(date)"
          echo "âš½ å¼€å§‹ç”Ÿæˆæ¬§æ´²è¶³çƒæ¯”èµ›æ—¥æŠ¥..."
          
          # æ£€æŸ¥æ˜¯å¦ä¸ºè‡ªåŠ¨è°ƒåº¦è¿è¡Œ
          if [ "${{ github.event_name }}" = "schedule" ]; then
            echo "ğŸ“… è‡ªåŠ¨è°ƒåº¦è¿è¡Œ - ç”Ÿæˆè¶³çƒæ—¥æŠ¥"
          elif [ "${{ github.event.inputs.test_mode }}" = "test" ]; then
            echo "ğŸ§ª æ‰‹åŠ¨æµ‹è¯•æ¨¡å¼"
          else
            echo "ğŸ”§ æ‰‹åŠ¨å®Œæ•´æ¨¡å¼"
          fi
          
          python football_monitor.py
          echo "âœ… è¶³çƒç›‘æ§å®Œæˆ"
